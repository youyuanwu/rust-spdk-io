# spdk-io-sys

Low-level FFI bindings to [SPDK](https://spdk.io) (Storage Performance Development Kit).

## Overview

This crate provides raw bindings generated by [bindgen](https://github.com/rust-lang/rust-bindgen) from SPDK headers. For a safe, ergonomic API, use the [`spdk-io`](../spdk-io) crate instead.

## Bound APIs

The bindings include:

| Module | Headers |
|--------|---------|
| Environment | `spdk/env.h`, `spdk/init.h` |
| Threading | `spdk/thread.h` |
| Block Device | `spdk/bdev.h`, `spdk/bdev_module.h` |
| Blobstore | `spdk/blob.h`, `spdk/blob_bdev.h` |
| NVMe | `spdk/nvme.h`, `spdk/nvme_spec.h` |
| NVMe-oF | `spdk/nvmf.h`, `spdk/nvmf_transport.h` |
| Utilities | `spdk/log.h`, `spdk/string.h`, `spdk/json.h` |
| Event Framework | `spdk/event.h` |

## Prerequisites

SPDK must be installed and accessible via `pkg-config`:

```bash
# Check SPDK is discoverable
export PKG_CONFIG_PATH=/opt/spdk/lib/pkgconfig:$PKG_CONFIG_PATH
pkg-config --exists spdk_env_dpdk && echo "SPDK found"
```

## Building

```bash
export PKG_CONFIG_PATH=/opt/spdk/lib/pkgconfig:$PKG_CONFIG_PATH
cargo build
```

## Linking

This crate links **statically** against SPDK and DPDK libraries with proper `--whole-archive` handling for constructor functions (DPDK's `RTE_INIT`, SPDK's subsystem registration macros).

The `links = "spdk"` key in `Cargo.toml` ensures only one copy of SPDK is linked per binary.

## Usage

```rust
use spdk_io_sys::*;

// Direct FFI calls (unsafe)
unsafe {
    let opts = spdk_app_opts::default();
    // ...
}
```

## License

MIT
